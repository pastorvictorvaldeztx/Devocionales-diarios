<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìñ Devocional Diario - Iglesia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.3s ease;
        }

        body.dark-mode {
            background: #1a1f28;
            color: #e0e0e0;
        }

        .screen {
            display: none;
            width: 100%;
            max-width: 600px;
        }

        .screen.active {
            display: block;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        body.dark-mode .container {
            background: #232a35;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            color: #e0e0e0;
        }

        h1 {
            color: #555;
            margin-bottom: 20px;
            transition: color 0.3s;
        }

        body.dark-mode h1 {
            color: #d0d0d0;
        }

        .logo {
            width: 140px;
            max-width: 100%;
            height: auto;
            margin: 20px auto;
            display: block;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.3));
            transition: filter 0.3s;
        }

        body.dark-mode .logo {
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.7));
        }

        button {
            display: block;
            width: 80%;
            padding: 12px;
            margin: 15px auto;
            border: none;
            border-radius: 8px;
            background: #667eea;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
        }

        button:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        body.dark-mode button {
            background: #3a4b6c;
            color: #e0e0e0;
        }

        body.dark-mode button:hover {
            background: #4a5b7c;
        }

        button.danger {
            background: #e74c3c;
        }

        button.danger:hover {
            background: #c0392b;
        }

        button.leaders {
            background: #27ae60;
        }

        button.leaders:hover {
            background: #229954;
        }

        button.share {
            background: #25D366;
        }

        button.share:hover {
            background: #128C7E;
        }

        button.night {
            background: #555;
        }

        button.night:hover {
            background: #444;
        }

        body.dark-mode button.night {
            background: #888;
        }

        body.dark-mode button.night:hover {
            background: #999;
        }

        button.delete {
            background: #e74c3c;
            width: 70%;
            margin-top: 10px;
        }

        button.delete:hover {
            background: #c0392b;
        }

        .devotional-content {
            text-align: left;
            margin-top: 20px;
            line-height: 1.6;
            transition: color 0.3s;
        }

        body.dark-mode .devotional-content {
            color: #e0e0e0;
        }

        .devotional-content p {
            margin: 10px 0;
        }

        .devotional-content strong {
            color: #667eea;
            transition: color 0.3s;
        }

        body.dark-mode .devotional-content strong {
            color: #7a8eeb;
        }

        #title {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 15px;
            transition: color 0.3s;
        }

        body.dark-mode #title {
            color: #d0d0d0;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            background: white;
            color: #333;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        body.dark-mode input,
        body.dark-mode textarea {
            background: #2a3240;
            color: #e0e0e0;
            border-color: #444;
        }

        .back-btn {
            background: #95a5a6;
            width: 60%;
            margin-top: 30px;
        }

        body.dark-mode .back-btn {
            background: #6a7a7b;
        }

        .history-list {
            text-align: left;
            margin-top: 20px;
        }

        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }

        body.dark-mode .history-item {
            border-bottom: 1px solid #444;
        }

        .history-item:hover {
            background: #f9f9f9;
        }

        body.dark-mode .history-item:hover {
            background: #333c4e;
        }

        footer {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #888;
            transition: color 0.3s;
        }

        body.dark-mode footer {
            color: #aaa;
        }

        #messages-list {
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 15px 0;
            transition: background-color 0.3s;
        }

        body.dark-mode #messages-list {
            background: #2a3240;
        }

        .message-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            transition: background 0.2s;
        }

        body.dark-mode .message-item {
            border-bottom: 1px solid #444;
        }

        .message-item:hover {
            background: #f0f0f0;
        }

        body.dark-mode .message-item:hover {
            background: #333c4e;
        }
    </style>
</head>
<body>

    <audio id="click-sound" src="https://assets.mixkit.co/active_storage/sfx/3100/3100-preview.mp3" preload="auto"></audio>
    <audio id="notify-sound" src="https://assets.mixkit.co/active_storage/sfx/3100/3100-preview.mp3" preload="auto"></audio>

    <!-- PANTALLA DE BIENVENIDA -->
    <div id="welcome-screen" class="screen active">
        <div class="container">
            <img src="https://i.postimg.cc/XJC7kmqY/IMG-6770.jpg" alt="Logo Iglesia" class="logo">
            <h1>Devocional Diario</h1>
            <p>Un momento a solas con Dios cada d√≠a.</p>
            <button onclick="playClickSound(); showScreen('today-screen')">üìñ Devocional de Hoy</button>
            <button onclick="playClickSound(); showScreen('history-screen')">üìö Devocionales Anteriores</button>
            <button onclick="playClickSound(); showPasswordModal()" class="leaders">üîê Subir Nuevo Devocional</button>
            <button onclick="playClickSound(); showLeadersModal()" class="leaders">üë• L√≠deres</button>
            <button class="share" onclick="playClickSound(); shareAppByWhatsApp()">üì≤ Invitar por WhatsApp</button>
            <button class="night" onclick="toggleDarkMode()">üåô Modo Noche</button>
        </div>
    </div>

    <!-- PANTALLA: DEVOCIONAL DE HOY -->
    <div id="today-screen" class="screen">
        <div class="container">
            <h1>üìñ Devocional de Hoy</h1>
            <div class="devotional-content">
                <h2 id="today-title">Cargando...</h2>
                <p><strong>Vers√≠culo:</strong> <span id="today-verse"></span></p>
                <p><strong>Reflexi√≥n:</strong> <span id="today-reflection"></span></p>
                <p><strong>Oraci√≥n:</strong> <span id="today-prayer"></span></p>
            </div>
            <button class="share" onclick="playClickSound(); shareDevotionalByWhatsApp()">üì≤ Compartir Devocional</button>
            <button class="night" onclick="toggleDarkMode()">üåô Modo Noche</button>
            <button class="back-btn" onclick="playClickSound(); showScreen('welcome-screen')">‚Üê Volver</button>
            <footer id="today-date"></footer>
        </div>
    </div>

    <!-- PANTALLA: HISTORIAL -->
    <div id="history-screen" class="screen">
        <div class="container">
            <h1>üìö Devocionales Anteriores</h1>
            <div id="history-list" class="history-list">
            </div>
            <button class="night" onclick="toggleDarkMode()">üåô Modo Noche</button>
            <button class="back-btn" onclick="playClickSound(); showScreen('welcome-screen')">‚Üê Volver</button>
        </div>
    </div>

    <!-- PANTALLA: SUBIR DEVOCIONAL -->
    <div id="upload-screen" class="screen">
        <div class="container">
            <h1>üì§ Subir Nuevo Devocional</h1>
            <input type="text" id="new-title" placeholder="T√≠tulo del devocional" required>
            <input type="text" id="new-verse" placeholder="Vers√≠culo (Ej: Filipenses 4:13)" required>
            <textarea id="new-reflection" rows="4" placeholder="Reflexi√≥n..." required></textarea>
            <textarea id="new-prayer" rows="3" placeholder="Oraci√≥n..." required></textarea>
            <button onclick="playClickSound(); saveNewDevotional()">‚úÖ Guardar Devocional</button>
            <button class="delete" onclick="playClickSound(); deleteLastDevotional()">üóëÔ∏è Eliminar √öltimo Devocional</button>
            <button class="night" onclick="toggleDarkMode()">üåô Modo Noche</button>
            <button class="back-btn" onclick="playClickSound(); showScreen('welcome-screen')">‚Üê Volver</button>
        </div>
    </div>

    <!-- PANTALLA: L√çDERES -->
    <div id="leaders-screen" class="screen">
        <div class="container">
            <h1>üì¢ Comunicaciones a L√≠deres</h1>
            <textarea id="leader-message" rows="4" placeholder="Escribe aqu√≠ el mensaje para los l√≠deres..." style="margin-bottom:15px;"></textarea>
            <button onclick="playClickSound(); sendLeaderMessage()">üì§ Enviar Mensaje</button>
            <h3>üì¨ Mensajes Recientes</h3>
            <div id="messages-list">
            </div>
            <button class="night" onclick="toggleDarkMode()">üåô Modo Noche</button>
            <button class="back-btn" onclick="playClickSound(); showScreen('welcome-screen')">‚Üê Volver</button>
        </div>
    </div>

    <!-- MODAL: CONTRASE√ëA SUBIR DEVOCIONAL -->
    <div id="password-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; justify-content:center; align-items:center;">
        <div class="container" style="max-width:400px; padding:25px;">
            <h3>üîí Ingresa la contrase√±a</h3>
            <input type="password" id="password-input" placeholder="Contrase√±a" style="width:100%; padding:10px; margin:15px 0; border-radius:5px; border:1px solid #ccc;">
            <button onclick="playClickSound(); checkPassword()">Ingresar</button>
            <button class="back-btn" onclick="playClickSound(); closePasswordModal()">Cancelar</button>
        </div>
    </div>

    <!-- MODAL: CONTRASE√ëA L√çDERES -->
    <div id="leaders-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:1000; justify-content:center; align-items:center;">
        <div class="container" style="max-width:400px; padding:25px;">
            <h3>üîê √Årea de L√≠deres</h3>
            <p>Ingresa la contrase√±a para acceder</p>
            <input type="password" id="leaders-password" placeholder="Contrase√±a de l√≠deres" style="width:100%; padding:10px; margin:15px 0; border-radius:5px; border:1px solid #ccc;">
            <button onclick="playClickSound(); checkLeadersPassword()">Ingresar</button>
            <button class="back-btn" onclick="playClickSound(); closeLeadersModal()">Cancelar</button>
        </div>
    </div>

    <script>
        function playClickSound() {
            const sound = document.getElementById('click-sound');
            sound.currentTime = 0;
            sound.volume = 0.2;
            sound.play().catch(e => console.log("Audio play failed:", e));
        }

        function playNotifySound() {
            const sound = document.getElementById('notify-sound');
            sound.currentTime = 0;
            sound.volume = 0.3;
            sound.play().catch(e => console.log("Audio play failed:", e));
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            playClickSound();
        }

        window.addEventListener('DOMContentLoaded', () => {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
        });

        let devocionales = JSON.parse(localStorage.getItem('devocionales')) || [
            {
                title: "Conf√≠a en el Se√±or",
                verse: "Proverbios 3:5 - Conf√≠a en el Se√±or de todo coraz√≥n, y no en tu propia inteligencia.",
                reflection: "A veces queremos controlarlo todo, pero Dios nos invita a soltar y confiar en Su plan perfecto.",
                prayer: "Se√±or, ay√∫dame a confiar en Ti en cada paso, especialmente cuando no entiendo lo que est√° pasando. Am√©n.",
                date: "2025-04-01"
            },
            {
                title: "Paz en medio de la tormenta",
                verse: "Filipenses 4:7 - Y la paz de Dios, que sobrepasa todo entendimiento, guardar√° sus corazones y sus mentes en Cristo Jes√∫s.",
                reflection: "La paz de Dios no depende de las circunstancias, sino de Su presencia constante en nuestras vidas.",
                prayer: "Gracias, Jes√∫s, por tu paz que calma mi coraz√≥n. Ay√∫dame a descansar en Ti hoy. Am√©n.",
                date: "2025-04-02"
            },
            {
                title: "Fuerza en la debilidad",
                verse: "2 Corintios 12:9 - Mi gracia te basta, porque mi poder se perfecciona en la debilidad.",
                reflection: "Cuando reconocemos nuestra debilidad, dejamos espacio para que el poder de Dios se manifieste plenamente.",
                prayer: "Se√±or, cuando me sienta d√©bil, recu√©rdame que Tu gracia es suficiente. Am√©n.",
                date: "2025-04-03"
            }
        ];

        let mensajesLideres = JSON.parse(localStorage.getItem('mensajesLideres')) || [];

        function saveDevocionales() {
            localStorage.setItem('devocionales', JSON.stringify(devocionales));
        }

        function saveMensajesLideres() {
            localStorage.setItem('mensajesLideres', JSON.stringify(mensajesLideres));
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if (screenId === 'today-screen') {
                loadTodayDevotional();
            } else if (screenId === 'history-screen') {
                loadHistory();
            } else if (screenId === 'leaders-screen') {
                loadLeaderMessages();
            }
        }

        // ‚úÖ Siempre muestra el √öLTIMO devocional subido HOY
        function loadTodayDevotional() {
            const todayStr = new Date().toISOString().split('T')[0];
            const todayDevotionals = devocionales.filter(d => d.date === todayStr);
            let todayDevotional = todayDevotionals.length > 0 
                ? todayDevotionals[todayDevotionals.length - 1] 
                : null;

            if (!todayDevotional) {
                const dayIndex = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                const baseDevotional = devocionales[dayIndex % devocionales.length];
                todayDevotional = {
                    ...baseDevotional,
                    date: todayStr
                };
                devocionales.push(todayDevotional);
                saveDevocionales();
            }

            document.getElementById('today-title').textContent = todayDevotional.title;
            document.getElementById('today-verse').textContent = todayDevotional.verse;
            document.getElementById('today-reflection').textContent = todayDevotional.reflection;
            document.getElementById('today-prayer').textContent = todayDevotional.prayer;
            document.getElementById('today-date').textContent = new Date().toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function shareAppByWhatsApp() {
            const appUrl = "https://vermillion-rabanadas-0c27f5.netlify.app/";
            const text = `üôå ¬°Te invito a usar esta app de Devocional Diario!\n\nCada d√≠a un momento de paz, reflexi√≥n y oraci√≥n.\n\n${appUrl}\n\nDevocional Diario - Iglesia Ebenezer`;

            const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function shareDevotionalByWhatsApp() {
            const title = document.getElementById('today-title').textContent;
            const verse = document.getElementById('today-verse').textContent;
            const reflection = document.getElementById('today-reflection').textContent;
            const prayer = document.getElementById('today-prayer').textContent;

            let text = `*${title}*\n\n`;
            text += `üìñ *${verse}*\n\n`;
            text += `üí≠ ${reflection}\n\n`;
            text += `üôè ${prayer}\n\n`;
            text += `Devocional Diario - Iglesia Ebenezer\n`;
            text += `¬°Comparte la bendici√≥n! üôå`;

            const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function loadHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';

            const sorted = [...devocionales].sort((a,b) => new Date(b.date) - new Date(a.date));
            const last7 = sorted.slice(0, 7);

            last7.forEach(dev => {
                const item = document.createElement('div');
                item.className = 'history-item';
                const devDate = new Date(dev.date);
                item.innerHTML = `<strong>${dev.title}</strong><br><small>${devDate.toLocaleDateString('es-ES')}</small>`;
                item.onclick = () => {
                    playClickSound();
                    showDevotionalDetail(dev);
                };
                historyList.appendChild(item);
            });
        }

        function showDevotionalDetail(dev) {
            document.getElementById('today-title').textContent = dev.title;
            document.getElementById('today-verse').textContent = dev.verse;
            document.getElementById('today-reflection').textContent = dev.reflection;
            document.getElementById('today-prayer').textContent = dev.prayer;
            document.getElementById('today-date').textContent = new Date(dev.date).toLocaleDateString('es-ES', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            showScreen('today-screen');
        }

        function showPasswordModal() {
            document.getElementById('password-modal').style.display = 'flex';
        }

        function closePasswordModal() {
            document.getElementById('password-modal').style.display = 'none';
            document.getElementById('password-input').value = '';
        }

        function checkPassword() {
            const password = document.getElementById('password-input').value;
            if (password === "Salmos23") {
                closePasswordModal();
                showScreen('upload-screen');
                document.getElementById('new-title').focus();
                playNotifySound();
            } else {
                alert("‚ùå Contrase√±a incorrecta");
            }
        }

        function showLeadersModal() {
            document.getElementById('leaders-modal').style.display = 'flex';
        }

        function closeLeadersModal() {
            document.getElementById('leaders-modal').style.display = 'none';
            document.getElementById('leaders-password').value = '';
        }

        function checkLeadersPassword() {
            const password = document.getElementById('leaders-password').value;
            if (password === "Lideres2025") {
                closeLeadersModal();
                showScreen('leaders-screen');
                document.getElementById('leader-message').focus();
                playNotifySound();
            } else {
                alert("‚ùå Contrase√±a incorrecta");
            }
        }

        function saveNewDevotional() {
            const title = document.getElementById('new-title').value.trim();
            const verse = document.getElementById('new-verse').value.trim();
            const reflection = document.getElementById('new-reflection').value.trim();
            const prayer = document.getElementById('new-prayer').value.trim();

            if (!title || !verse || !reflection || !prayer) {
                alert("Por favor, completa todos los campos.");
                return;
            }

            const newDev = {
                title,
                verse,
                reflection,
                prayer,
                date: new Date().toISOString().split('T')[0]
            };

            devocionales.push(newDev);
            saveDevocionales();

            alert("‚úÖ Devocional guardado correctamente");
            showScreen('welcome-screen');

            document.getElementById('new-title').value = '';
            document.getElementById('new-verse').value = '';
            document.getElementById('new-reflection').value = '';
            document.getElementById('new-prayer').value = '';
        }

        // ‚úÖ NUEVA FUNCI√ìN: Eliminar el √∫ltimo devocional subido
        function deleteLastDevotional() {
            if (devocionales.length === 0) {
                alert("No hay devocionales para eliminar.");
                return;
            }

            const confirm = window.confirm("‚ö†Ô∏è ¬øEst√°s seguro de que quieres eliminar el √∫ltimo devocional que subiste?\n\nEsta acci√≥n no se puede deshacer.");
            if (!confirm) return;

            // Elimina el √∫ltimo elemento del array
            devocionales.pop();
            saveDevocionales();

            alert("üóëÔ∏è √öltimo devocional eliminado correctamente.");
            loadTodayDevotional(); // Recarga el devocional actual (por si era el que eliminaste)
        }

        function sendLeaderMessage() {
            const message = document.getElementById('leader-message').value.trim();
            if (!message) {
                alert("Por favor, escribe un mensaje.");
                return;
            }

            const newMessage = {
                text: message,
                date: new Date().toLocaleString('es-ES'),
                sender: "Administrador"
            };

            mensajesLideres.unshift(newMessage);
            if (mensajesLideres.length > 20) mensajesLideres.pop();
            saveMensajesLideres();

            document.getElementById('leader-message').value = '';
            loadLeaderMessages();
            alert("‚úÖ Mensaje enviado a l√≠deres");
            playNotifySound();
        }

        function loadLeaderMessages() {
            const list = document.getElementById('messages-list');
            list.innerHTML = '';

            if (mensajesLideres.length === 0) {
                list.innerHTML = "<p>No hay mensajes a√∫n.</p>";
                return;
            }

            mensajesLideres.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'message-item';
                div.innerHTML = `
                    <strong>${msg.sender}</strong> - <em>${msg.date}</em>
                    <p>${msg.text}</p>
                `;
                list.appendChild(div);
            });
        }

        saveDevocionales();
        saveMensajesLideres();
    </script>

</body>
</html>